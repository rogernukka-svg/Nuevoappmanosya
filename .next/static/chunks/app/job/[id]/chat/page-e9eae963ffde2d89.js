(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8079],{7998:function(e,a,s){Promise.resolve().then(s.bind(s,1339))},1339:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return o}});var n=s(7437),t=s(2265),r=s(6463),u=s(4667);function o(){let{id:e}=(0,r.useParams)(),[a,s]=(0,t.useState)([]),[o,i]=(0,t.useState)(null),[l,c]=(0,t.useState)(""),d=(0,t.useRef)(null);async function m(a){if(a.preventDefault(),!l.trim())return;let{error:s}=await u.supabase.rpc("post_message",{p_job_id:e,p_body:l});s?(console.error("Error al enviar mensaje:",s),alert("No se pudo enviar el mensaje")):c("")}return(0,t.useEffect)(()=>{(async function(){let{data:{user:a}}=await u.supabase.auth.getUser();i(null!=a?a:null);let{data:n}=await u.supabase.from("messages").select("*").eq("job_id",e).order("created_at",{ascending:!0});s(null!=n?n:[])})();let a=u.supabase.channel("msg-"+e).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"job_id=eq.".concat(e)},e=>{s(a=>[...a,e.new])}).subscribe();return()=>{u.supabase.removeChannel(a)}},[e]),(0,t.useEffect)(()=>{var e;null===(e=d.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[a.length]),(0,n.jsxs)("div",{className:"max-w-2xl mx-auto card",children:[(0,n.jsx)("h1",{children:"Chat del trabajo"}),(0,n.jsxs)("div",{className:"mt-3 h-80 overflow-auto space-y-2 bg-black/20 p-3 rounded-xl",children:[a.map(e=>(0,n.jsxs)("div",{className:"max-w-[80%] px-3 py-2 rounded-xl ".concat(e.sender_id===(null==o?void 0:o.id)?"ml-auto bg-sky-500/20":"bg-white/10"),children:[(0,n.jsx)("div",{className:"text-xs opacity-60",children:new Date(e.created_at).toLocaleString()}),(0,n.jsx)("div",{children:e.body})]},e.id)),(0,n.jsx)("div",{ref:d})]}),(0,n.jsxs)("form",{onSubmit:m,className:"mt-3 flex gap-2",children:[(0,n.jsx)("input",{className:"flex-1 rounded-lg p-2 text-black",value:l,onChange:e=>c(e.target.value),placeholder:"Escrib\xed un mensaje..."}),(0,n.jsx)("button",{className:"btn",children:"Enviar"})]})]})}},4667:function(e,a,s){"use strict";s.d(a,{S:function(){return r}});var n=s(951);let t=null;function r(){if(t)return t;let e="https://ydtficoxjuxsoaxtghhj.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkdGZpY294anV4c29heHRnaGhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwOTUwNDIsImV4cCI6MjA3NTY3MTA0Mn0.KBRDCAJYvjpmcXRnYFcuSI8Mn0zYfJzaN0QJo63gzy8";if(!e||!a)throw console.error("❌ Faltan variables de entorno de Supabase."),Error("Variables de entorno Supabase no configuradas.");return t=(0,n.createBrowserClient)(e,a,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),console.log("✅ Supabase (browser client) inicializado en",e),t}},6463:function(e,a,s){"use strict";var n=s(1169);s.o(n,"useParams")&&s.d(a,{useParams:function(){return n.useParams}}),s.o(n,"usePathname")&&s.d(a,{usePathname:function(){return n.usePathname}}),s.o(n,"useRouter")&&s.d(a,{useRouter:function(){return n.useRouter}})}},function(e){e.O(0,[951,2971,7023,1744],function(){return e(e.s=7998)}),_N_E=e.O()}]);