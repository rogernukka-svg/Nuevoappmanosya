(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9992],{6425:function(e,t,n){Promise.resolve().then(n.bind(n,899))},899:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var r=n(7437),a=n(2265),s=n(4667),i=n(518),c=n(7091),o=n(6463),u=n(7776),l=n(3763);let d=(0,s.S)();function f(){let e=(0,o.useRouter)(),t=(0,o.useParams)(),n=null==t?void 0:t.id,[s,f]=(0,a.useState)(null),[h,m]=(0,a.useState)([]),[x,b]=(0,a.useState)(!1),p=(0,a.useRef)(null),g=(0,a.useRef)(null);async function y(e){var t;e.preventDefault();let r=null===(t=p.current)||void 0===t?void 0:t.value.trim();if(r)try{b(!0),await d.from("messages").insert([{chat_id:n,sender_id:s.id,content:r}]),p.current.value=""}catch(e){u.A.error("Error enviando mensaje")}finally{b(!1)}}return(0,a.useEffect)(()=>{d.auth.getUser().then(e=>{let{data:t}=e;(null==t?void 0:t.user)&&f(t.user)})},[]),(0,a.useEffect)(()=>{if(!n||!s)return;(async()=>{let{data:e,error:t}=await d.from("messages").select("*").eq("chat_id",n).order("created_at",{ascending:!0});t?console.error(t):m(e||[])})();let e=d.channel("chat-".concat(n)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"chat_id=eq.".concat(n)},e=>m(t=>[...t,e.new])).subscribe();return g.current=e,()=>d.removeChannel(e)},[n,s]),(0,r.jsxs)(l.E.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col h-screen bg-white",children:[(0,r.jsxs)("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[(0,r.jsxs)("button",{onClick:()=>e.back(),className:"text-gray-600 flex items-center gap-1",children:[(0,r.jsx)(i.Z,{size:18})," Volver"]}),(0,r.jsx)("h1",{className:"font-semibold text-gray-800",children:"Chat"}),(0,r.jsx)("div",{className:"w-6"})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:h.map(e=>{let t=e.sender_id===(null==s?void 0:s.id);return(0,r.jsx)("div",{className:"flex ".concat(t?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-[80%] px-3 py-2 rounded-2xl text-sm shadow-sm ".concat(t?"bg-emerald-500 text-white":"bg-gray-100 text-gray-800"),children:[e.content,(0,r.jsx)("div",{className:"text-[10px] mt-1 opacity-70 ".concat(t?"text-white":"text-gray-500"),children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id)})}),(0,r.jsxs)("form",{onSubmit:y,className:"p-3 border-t border-gray-200 flex gap-2",children:[(0,r.jsx)("input",{ref:p,type:"text",placeholder:"Escrib\xed un mensaje...",className:"flex-1 bg-gray-100 rounded-xl px-3 py-3 outline-none focus:ring-2 focus:ring-emerald-400 border border-gray-200"}),(0,r.jsx)("button",{disabled:x,className:"px-4 rounded-xl bg-emerald-500 text-white font-semibold hover:bg-emerald-600 transition disabled:opacity-60",children:(0,r.jsx)(c.Z,{size:18})})]})]})}},4667:function(e,t,n){"use strict";n.d(t,{S:function(){return s}});var r=n(951);let a=null;function s(){if(a)return a;let e="https://ydtficoxjuxsoaxtghhj.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkdGZpY294anV4c29heHRnaGhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwOTUwNDIsImV4cCI6MjA3NTY3MTA0Mn0.KBRDCAJYvjpmcXRnYFcuSI8Mn0zYfJzaN0QJo63gzy8";if(!e||!t)throw console.error("❌ Faltan variables de entorno de Supabase."),Error("Variables de entorno Supabase no configuradas.");return a=(0,r.createBrowserClient)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),console.log("✅ Supabase (browser client) inicializado en",e),a}},518:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8030).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},7091:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8030).Z)("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]])},6463:function(e,t,n){"use strict";var r=n(1169);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})}},function(e){e.O(0,[951,7776,3642,2971,7023,1744],function(){return e(e.s=6425)}),_N_E=e.O()}]);