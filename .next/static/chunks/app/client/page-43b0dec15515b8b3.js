(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8394],{4198:function(e,t,a){Promise.resolve().then(a.bind(a,4798))},4798:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var r=a(7437),s=a(2265),n=a(3763),l=a(4378),i=a(4817),c=a(5912);let o=(0,a(8030).Z)("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);var d=a(9338),u=a(7138),h=a(6463),m=a(4667),f=a(7776);let x=(0,m.S)();function p(){var e,t,a;let m=(0,h.useRouter)(),[p,b]=(0,s.useState)(!1),[w,g]=(0,s.useState)(null),[y,v]=(0,s.useState)(null),[j,N]=(0,s.useState)([]),[k,_]=(0,s.useState)([]),[C,D]=(0,s.useState)(!1),[S,E]=(0,s.useState)(!1);(0,s.useRef)(null);let I=(0,s.useRef)(null),M=(0,s.useRef)(null),[Z,R]=(0,s.useState)(!1),[z,A]=(0,s.useState)(0),[T,J]=(0,s.useState)("");async function P(){try{if(!(null==y?void 0:y.id)||!(null==w?void 0:w.id)||!y.worker_id)return;let{data:e}=await x.from("chats").select("id").eq("job_id",y.id).maybeSingle();if(!(null==e?void 0:e.id))throw Error("Chat no encontrado.");let{data:t}=await x.from("messages").select("*").eq("chat_id",e.id).order("created_at",{ascending:!0});_(t||[]),D(!0),I.current&&x.removeChannel(I.current);let a=x.channel("chat-".concat(e.id)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"chat_id=eq.".concat(e.id)},e=>{let t=e.new;_(e=>[...e,t]),t.sender_id!==w.id&&(0,f.A)("\uD83D\uDCAC Nuevo mensaje: ".concat(t.content))}).subscribe();I.current=a}catch(e){f.A.error("No se pudo abrir el chat: "+e.message)}}return((0,s.useEffect)(()=>b(!0),[]),(0,s.useEffect)(()=>{p&&(localStorage.getItem("app_role")||m.replace("/role-selector"))},[p,m]),(0,s.useEffect)(()=>{x.auth.getUser().then(e=>{let{data:t}=e;(null==t?void 0:t.user)?g(t.user):m.replace("/login")})},[m]),(0,s.useEffect)(()=>{(null==w?void 0:w.id)&&(async()=>{let{data:e}=await x.from("jobs").select("*, worker:profiles!worker_id(full_name, avatar_url)").eq("client_id",w.id).in("status",["taken","accepted","on_route","arrived","started","completed"]).order("created_at",{ascending:!1}).limit(1).maybeSingle();v(e||null)})()},[w]),(0,s.useEffect)(()=>{(null==w?void 0:w.id)&&(async()=>{let{data:e}=await x.from("reviews").select("rating, comment, created_at, worker:profiles!worker_id(full_name)").eq("client_id",w.id).order("created_at",{ascending:!1}).limit(3);N(e||[])})()},[w]),(0,s.useEffect)(()=>{if(!(null==w?void 0:w.id))return;M.current&&x.removeChannel(M.current);let e=x.channel("realtime-jobs").on("postgres_changes",{event:"UPDATE",schema:"public",table:"jobs",filter:"client_id=eq.".concat(w.id)},e=>{let t=e.new;t.id===(null==y?void 0:y.id)&&(v(t),(0,f.A)("\uD83D\uDD04 Estado actualizado: ".concat(t.status)),"completed"===t.status&&R(!0))}).subscribe();return M.current=e,()=>x.removeChannel(e)},[w,y]),(0,s.useEffect)(()=>()=>{I.current&&x.removeChannel(I.current),M.current&&x.removeChannel(M.current)},[]),p)?(0,r.jsxs)("div",{className:"min-h-screen flex flex-col items-center px-6 py-10 text-center bg-gradient-to-b from-white via-gray-50 to-gray-100",children:[(0,r.jsxs)("header",{className:"w-full max-w-4xl flex justify-between items-center mb-8",children:[(0,r.jsx)("span",{className:"text-gray-600 text-sm hidden sm:inline",children:"Modo Cliente \uD83C\uDFE0"}),(0,r.jsxs)("button",{onClick:()=>m.push("/role-selector"),className:"flex items-center gap-2 text-emerald-600 font-semibold hover:text-emerald-700 transition",children:[(0,r.jsx)(l.Z,{size:16})," Cambiar rol"]})]}),(0,r.jsxs)(n.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4},className:"mb-8",children:[(0,r.jsxs)("h1",{className:"text-3xl md:text-4xl font-extrabold text-emerald-600 mb-2",children:["Hola \uD83D\uDC4B ",(null==w?void 0:null===(t=w.user_metadata)||void 0===t?void 0:null===(e=t.full_name)||void 0===e?void 0:e.split(" ")[0])||""]}),(0,r.jsx)("p",{className:"text-gray-600 max-w-md text-sm md:text-base leading-relaxed",children:"\xbfQu\xe9 necesit\xe1s hoy? Eleg\xed una opci\xf3n para comenzar."})]}),(0,r.jsxs)("div",{className:"flex flex-col w-full max-w-xs gap-4",children:[(0,r.jsx)(u.default,{href:"/map",children:(0,r.jsxs)(n.E.button,{whileTap:{scale:.96},whileHover:{scale:1.05},className:"w-full flex flex-col items-center justify-center gap-1 border border-emerald-400 text-emerald-600 py-3 rounded-xl bg-white hover:bg-emerald-50 shadow-sm font-semibold transition",children:[(0,r.jsx)(i.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"\uD83D\uDD52 Urgente — Ver mapa de profesionales"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 font-normal",children:"Ideal para servicios inmediatos"})]})}),(0,r.jsx)(u.default,{href:"/client/new",children:(0,r.jsxs)(n.E.button,{whileTap:{scale:.96},whileHover:{scale:1.05},className:"w-full flex flex-col items-center justify-center gap-1 bg-gradient-to-r from-emerald-500 to-teal-500 text-white py-3 rounded-xl shadow-md hover:shadow-lg transition",children:[(0,r.jsx)(c.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"\uD83D\uDCC5 Program\xe1 tu pedido"}),(0,r.jsx)("p",{className:"text-xs text-white/80 font-normal",children:"Perfecto para tareas planificadas"})]})}),(0,r.jsx)(u.default,{href:"/client/jobs",children:(0,r.jsxs)(n.E.button,{whileTap:{scale:.96},whileHover:{scale:1.05},className:"w-full flex items-center justify-center gap-2 border border-gray-200 text-gray-700 py-3 rounded-xl bg-white hover:bg-gray-50 shadow-sm font-semibold transition",children:[(0,r.jsx)(o,{className:"w-5 h-5"})," Ver mis pedidos"]})}),(null==y?void 0:y.worker)&&(0,r.jsxs)(n.E.button,{whileTap:{scale:.96},whileHover:{scale:1.05},onClick:P,className:"w-full flex items-center justify-center gap-2 bg-gray-100 text-gray-800 py-3 rounded-xl hover:bg-gray-200 font-semibold transition",children:["\uD83D\uDCAC Chat con ",(null===(a=y.worker)||void 0===a?void 0:a.full_name)||"trabajador"]})]}),j.length>0&&(0,r.jsxs)("div",{className:"mt-10 w-full max-w-md text-left",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-700 mb-2",children:"Tus \xfaltimas calificaciones \uD83C\uDF1F"}),(0,r.jsx)("div",{className:"space-y-2",children:j.map((e,t)=>(0,r.jsxs)("div",{className:"p-3 bg-white rounded-xl border shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-sm font-semibold text-emerald-600",children:e.worker.full_name}),(0,r.jsx)("div",{className:"flex gap-1",children:[...Array(e.rating)].map((e,t)=>(0,r.jsx)(d.Z,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"},t))})]}),e.comment&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.comment})]},t))})]})]}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white text-emerald-600 font-semibold",children:"Cargando Modo Cliente…"})}},4667:function(e,t,a){"use strict";a.d(t,{S:function(){return n}});var r=a(951);let s=null;function n(){if(s)return s;let e="https://ydtficoxjuxsoaxtghhj.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkdGZpY294anV4c29heHRnaGhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwOTUwNDIsImV4cCI6MjA3NTY3MTA0Mn0.KBRDCAJYvjpmcXRnYFcuSI8Mn0zYfJzaN0QJo63gzy8";if(!e||!t)throw console.error("❌ Faltan variables de entorno de Supabase."),Error("Variables de entorno Supabase no configuradas.");return s=(0,r.createBrowserClient)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),console.log("✅ Supabase (browser client) inicializado en",e),s}},5912:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(8030).Z)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]])},4378:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(8030).Z)("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]])},4817:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(8030).Z)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},9338:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(8030).Z)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])},7138:function(e,t,a){"use strict";a.d(t,{default:function(){return s.a}});var r=a(231),s=a.n(r)},6463:function(e,t,a){"use strict";var r=a(1169);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})}},function(e){e.O(0,[951,7776,3642,231,2971,7023,1744],function(){return e(e.s=4198)}),_N_E=e.O()}]);