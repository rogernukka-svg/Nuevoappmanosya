(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8394],{4198:function(e,t,a){Promise.resolve().then(a.bind(a,4821))},4821:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Z}});var s=a(7437),l=a(2265),i=a(7818);a(966);var n=a(6463),r=a(5348),o=a(3763),c=a(3622),d=a(3045),u=a(3907),x=a(5575),m=a(5293),h=a(4512),b=a(3765),p=a(9338),f=a(5193),g=a(7583),j=a(1935),y=a(4667),w=a(7776),v=a(556);let N=(0,y.S)(),k=(0,i.default)(()=>a.e(9720).then(a.bind(a,9720)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[9720]},ssr:!1}),z=(0,i.default)(()=>a.e(9720).then(a.bind(a,9720)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[9720]},ssr:!1}),C=(0,i.default)(()=>a.e(9720).then(a.bind(a,9720)).then(e=>e.Marker),{loadableGenerated:{webpack:()=>[9720]},ssr:!1}),D=(0,i.default)(()=>a.e(9720).then(a.bind(a,9720)).then(e=>e.Tooltip),{loadableGenerated:{webpack:()=>[9720]},ssr:!1}),_=(0,i.default)(()=>a.e(9720).then(a.bind(a,9720)).then(e=>e.Polyline),{loadableGenerated:{webpack:()=>[9720]},ssr:!1}),E=(0,i.default)(()=>a.e(5790).then(a.bind(a,5790)).then(e=>e.default),{loadableGenerated:{webpack:()=>[5790]},ssr:!1});function S(e){let{center:t}=e,a=(0,v.Sx)();return(0,l.useEffect)(()=>{a&&t&&a.setView(t,14)},[t,a]),null}function I(e){let t=a(7691),s=e.getChildCount();return t.divIcon({html:'\n    <div class="cluster-pulse" style="\n      width:64px;height:64px;border-radius:50%;\n      background:#10b981;display:flex;align-items:center;justify-content:center;\n      box-shadow:0 0 12px rgba(16,185,129,0.6);\n      color:#fff;font-weight:700;font-size:14px;position:relative;">\n      <div style="position:absolute;inset:3px;border-radius:50%;background:#059669;z-index:1;"></div>\n      <span style="position:relative;z-index:2;">'.concat(s,"</span>\n    </div>"),iconSize:[64,64],className:"cluster-animated"})}{let e=document.createElement("style");e.innerHTML="\n    .cluster-pulse { animation: pulse 2s infinite; }\n    @keyframes pulse {\n      0% { transform: scale(1); box-shadow: 0 0 0 rgba(16,185,129,0.35); }\n      50% { transform: scale(1.08); box-shadow: 0 0 25px rgba(16,185,129,0.55); }\n      100% { transform: scale(1); box-shadow: 0 0 0 rgba(16,185,129,0.35); }\n    }",document.head.querySelector("style[data-manosya-pulse]")||(e.setAttribute("data-manosya-pulse","1"),document.head.appendChild(e))}function Z(){let e=(0,n.useRouter)(),t=(0,l.useRef)(null),[i,y]=(0,l.useState)([-25.516,-54.616]),[v,Z]=(0,l.useState)({id:null,lat:null,lon:null}),[A,M]=(0,l.useState)([]),[J,T]=(0,l.useState)(!1),[G,P]=(0,l.useState)(null),[B,F]=(0,l.useState)(!1),[R,Y]=(0,l.useState)(null),[O,U]=(0,l.useState)(null),H=[{id:"plomer\xeda",label:"Plomer\xeda",icon:(0,s.jsx)(c.Z,{size:18})},{id:"electricidad",label:"Electricidad",icon:(0,s.jsx)(d.Z,{size:18})},{id:"limpieza",label:"Limpieza",icon:(0,s.jsx)(u.Z,{size:18})},{id:"construcci\xf3n",label:"Construcci\xf3n",icon:(0,s.jsx)(x.Z,{size:18})},{id:"jardiner\xeda",label:"Jardiner\xeda",icon:(0,s.jsx)(m.Z,{size:18})},{id:"mascotas",label:"Mascotas",icon:(0,s.jsx)(h.Z,{size:18})},{id:"emergencia",label:"Emergencia",icon:(0,s.jsx)(b.Z,{size:18})}];async function L(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;T(!0);try{let t=N.from("map_workers_view").select("*").not("lat","is",null).not("lng","is",null);e&&(t=t.ilike("skills","%".concat(e,"%")));let{data:a,error:s}=await t;if(s)throw s;M(a||[])}catch(e){w.A.error("Error cargando trabajadores")}finally{T(!1)}}async function V(){try{F(!1),w.A.loading("Enviando solicitud...",{id:"pedido"});let{data:{user:e},error:a}=await N.auth.getUser();if(a||!e)throw Error("Sesi\xf3n no encontrada");if(!G||!G.user_id)throw Error("No se seleccion\xf3 un trabajador v\xe1lido");let{error:s}=await N.from("jobs").insert([{title:"Trabajo con ".concat(G.full_name||"Trabajador"),description:"Pedido generado desde el mapa",status:"open",client_id:e.id,worker_id:G.user_id,client_lat:v.lat,client_lng:v.lon,worker_lat:G.lat,worker_lng:G.lng,created_at:new Date().toISOString()}]);if(s)throw s;w.A.success("✅ Pedido enviado a ".concat(G.full_name),{id:"pedido"}),M([G]),Y([[v.lat,v.lon],[G.lat,G.lng]]),t.current&&v.lat&&(null==G?void 0:G.lat)&&t.current.fitBounds([[v.lat,v.lon],[G.lat,G.lng]],{padding:[80,80]})}catch(e){console.error("Error al confirmar solicitud:",e.message),w.A.error(e.message||"No se pudo enviar el pedido",{id:"pedido"})}}return(0,l.useEffect)(()=>{(async()=>{var t;let{data:a}=await N.auth.getUser(),s=null==a?void 0:null===(t=a.user)||void 0===t?void 0:t.id;s?Z(e=>({...e,id:s})):e.replace("/login")})()},[e]),(0,l.useEffect)(()=>{if(!navigator.geolocation)return;let e=navigator.geolocation.watchPosition(e=>{let t=e.coords.latitude,a=e.coords.longitude;y([t,a]),Z(e=>({...e,lat:t,lon:a}))},()=>{},{enableHighAccuracy:!0});return()=>e&&navigator.geolocation.clearWatch(e)},[]),(0,l.useEffect)(()=>{L()},[]),(0,l.useEffect)(()=>{let e=N.channel("jobs-realtime-client").on("postgres_changes",{event:"*",schema:"public",table:"jobs"},e=>{var t;(null===(t=e.new)||void 0===t?void 0:t.client_id)===v.id&&w.A.info("\uD83D\uDD04 Pedido actualizado: ".concat(e.new.status))}).subscribe();return()=>N.removeChannel(e)},[v.id]),(0,s.jsxs)("div",{className:"relative min-h-screen bg-white",children:[(0,s.jsx)("div",{className:"absolute top-4 left-4 z-[1000]",children:(0,s.jsx)("button",{onClick:()=>e.push("/role-selector"),className:"bg-white border text-emerald-600 font-medium px-3 py-1.5 rounded-xl shadow-sm hover:bg-gray-50 transition",children:"Cambiar rol"})}),(0,s.jsx)("div",{className:"absolute inset-0 z-0",children:(0,s.jsxs)(k,{center:i,zoom:13,style:{height:"100%",width:"100%"},whenCreated:e=>t.current=e,children:[(0,s.jsx)(S,{center:i}),(0,s.jsx)(z,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png"}),R&&(0,s.jsx)(_,{positions:R,color:"#10b981",weight:5}),(0,s.jsx)(E,{chunkedLoading:!0,maxClusterRadius:48,iconCreateFunction:I,children:A.map(e=>(0,s.jsx)(C,{position:[e.lat,e.lng],icon:function(e,t){let s=a(7691),l=(Date.now()-new Date((null==t?void 0:t.updated_at)||Date.now()).getTime())/6e4<=30?"#10b981":"#9ca3af",i='\n    <div style="width:'.concat(52,"px;height:").concat(52,'px;border-radius:50%;\n      position:relative;background:#fff;overflow:hidden;\n      box-shadow:0 6px 16px rgba(0,0,0,.12);">\n      <div style="position:absolute;inset:-4px;border-radius:50%;\n        border:3px solid ').concat(l,";\n        filter:drop-shadow(0 0 8px ").concat(l,'40);"></div>\n      <img src="').concat(e||"/avatar-fallback.png",'"\n           style="position:absolute;inset:0;width:100%;height:100%;\n           object-fit:cover;border-radius:50%;" />\n    </div>');return s.divIcon({html:i,iconSize:[52,52],className:""})}(e.avatar_url,e),eventHandlers:{click:()=>{P(e),F(!1)}},children:(0,s.jsx)(D,{children:(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsx)("strong",{children:e.full_name}),(0,s.jsxs)("p",{children:["Servicio: ",e.main_skill||"No especificado"]}),(0,s.jsx)("p",{children:"\uD83D\uDCB0 Desde ₲45.000"})]})})},e.user_id))})]})}),(0,s.jsxs)("div",{className:"fixed left-0 right-0 bottom-0 z-[9999] bg-white rounded-t-3xl border-t border-gray-200 overflow-y-auto",style:{maxHeight:"45vh"},children:[(0,s.jsx)("div",{className:"flex justify-center items-center py-3",children:(0,s.jsx)("div",{className:"h-1.5 w-12 rounded-full bg-emerald-500"})}),(0,s.jsxs)("div",{className:"px-5 pb-8",children:[(0,s.jsx)("h2",{className:"text-center text-lg font-bold text-emerald-600 mb-3",children:"ManosYA"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-5",children:[(0,s.jsx)("button",{onClick:()=>L(O),className:"bg-emerald-500 text-white font-semibold py-3 rounded-xl",children:"\uD83D\uDE80 Buscar Pros"}),(0,s.jsx)("button",{onClick:()=>e.push("/client/jobs"),className:"bg-white border font-semibold py-3 rounded-xl",children:"\uD83D\uDCE6 Mis pedidos"}),(0,s.jsx)("button",{onClick:()=>e.push("/client/new"),className:"bg-white border font-semibold py-3 rounded-xl",children:"\uD83C\uDFE2 Empresarial"})]}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2 text-sm mb-4",children:H.map(e=>(0,s.jsxs)("button",{onClick:()=>(function(e){let t=O===e?null:e;U(t),P(null),Y(null),L(t)})(e.id),className:"flex items-center justify-center gap-1 px-2 py-2 rounded-lg border ".concat(O===e.id?"bg-emerald-500 text-white border-emerald-500":"bg-gray-50 text-gray-700 border-gray-200"),children:[e.icon,(0,s.jsx)("span",{className:"capitalize",children:e.label})]},e.id))}),(0,s.jsx)("p",{className:"text-xs text-gray-500 italic text-center",children:J?"Buscando trabajadores cerca…":"".concat(A.length," trabajadores activos cerca")})]})]}),(0,s.jsx)(r.M,{children:G&&!B&&(0,s.jsx)(o.E.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",stiffness:120,damping:18},className:"fixed inset-x-0 bottom-0 bg-white rounded-t-3xl shadow-xl p-6 z-[10000]",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("img",{src:G.avatar_url||"/avatar-fallback.png",className:"w-20 h-20 mx-auto rounded-full border-4 border-emerald-500 mb-2",alt:"avatar"}),(0,s.jsx)("h2",{className:"font-bold text-lg",children:G.full_name}),(0,s.jsxs)("p",{className:"text-sm italic text-gray-500 mb-2",children:["“",G.bio||"Sin descripci\xf3n","”"]}),(0,s.jsxs)("div",{className:"flex justify-center items-center gap-1 mb-2",children:[(0,s.jsx)(p.Z,{size:14,className:"text-yellow-400 fill-yellow-400"}),(0,s.jsx)(p.Z,{size:14,className:"text-yellow-400 fill-yellow-400"}),(0,s.jsx)(p.Z,{size:14,className:"text-yellow-400 fill-yellow-400"}),(0,s.jsx)(p.Z,{size:14,className:"text-yellow-400 fill-yellow-400"}),(0,s.jsx)(p.Z,{size:14,className:"text-gray-300"}),(0,s.jsx)("span",{className:"text-xs text-gray-500 ml-1",children:"(2)"})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,s.jsx)(f.Z,{size:14,className:"inline mr-1"})," 12 a\xf1os de experiencia"]}),(0,s.jsx)("p",{className:"text-sm text-emerald-600 font-medium mt-1",children:"Frecuente en tu zona"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Activo hace 12 d\xedas"}),(0,s.jsxs)("div",{className:"mt-3 bg-gray-50 rounded-xl p-2 text-sm text-gray-700",children:["Especialidades: ",G.skills||"limpieza, plomer\xeda, jardiner\xeda"]}),R?(0,s.jsxs)("div",{className:"flex justify-center gap-3 mt-5",children:[(0,s.jsxs)("button",{className:"px-5 py-3 rounded-xl border flex items-center gap-1",children:[(0,s.jsx)(g.Z,{size:16})," Chatear"]}),(0,s.jsxs)("button",{onClick:function(){Y(null),P(null),L(O||null)},className:"px-6 py-3 rounded-xl bg-red-500 text-white font-semibold flex items-center gap-1",children:[(0,s.jsx)(j.Z,{size:16})," Cancelar pedido"]})]}):(0,s.jsxs)("div",{className:"flex justify-center gap-3 mt-5",children:[(0,s.jsx)("button",{onClick:()=>P(null),className:"px-5 py-3 rounded-xl border text-gray-700",children:"Cerrar"}),(0,s.jsx)("button",{onClick:function(){F(!0)},className:"px-6 py-3 rounded-xl bg-emerald-500 text-white font-semibold flex items-center gap-1",children:"\uD83D\uDE80 Solicitar"})]})]})},"perfil")}),(0,s.jsx)(r.M,{children:B&&(0,s.jsx)(o.E.div,{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[10010]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsxs)(o.E.div,{className:"bg-white rounded-3xl w-[85%] max-w-md p-6 shadow-lg text-center",initial:{scale:.9},animate:{scale:1},exit:{scale:.9},children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-emerald-600 mb-2",children:"Precio estimado"}),(0,s.jsx)("p",{className:"text-2xl font-extrabold text-emerald-700 mb-2",children:"₲55.000"}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 space-y-1 mb-4",children:[(0,s.jsx)("p",{children:"\uD83D\uDE97 Incluye traslado promedio (hasta 3 km)"}),(0,s.jsx)("p",{children:"\uD83C\uDF19 Urgencias nocturnas o feriados +20%"}),(0,s.jsx)("p",{children:"\uD83D\uDCB0 Tarifa m\xednima de visita ₲10.000"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[(0,s.jsx)("button",{onClick:()=>F(!1),className:"py-3 border rounded-xl hover:bg-gray-50",children:"Cancelar"}),(0,s.jsx)("button",{onClick:V,className:"py-3 rounded-xl bg-emerald-500 text-white font-semibold hover:bg-emerald-600 transition",children:"Confirmar"})]})]})},"precio")})]})}},4667:function(e,t,a){"use strict";a.d(t,{S:function(){return i}});var s=a(951);let l=null;function i(){if(l)return l;let e="https://ydtficoxjuxsoaxtghhj.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkdGZpY294anV4c29heHRnaGhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwOTUwNDIsImV4cCI6MjA3NTY3MTA0Mn0.KBRDCAJYvjpmcXRnYFcuSI8Mn0zYfJzaN0QJo63gzy8";if(!e||!t)throw console.error("❌ Faltan variables de entorno de Supabase."),Error("Variables de entorno Supabase no configuradas.");return l=(0,s.createBrowserClient)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),console.log("✅ Supabase (browser client) inicializado en",e),l}}},function(e){e.O(0,[2733,4212,951,7776,3642,6987,2971,7023,1744],function(){return e(e.s=4198)}),_N_E=e.O()}]);