(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[201],{9249:function(e,t,n){Promise.resolve().then(n.bind(n,5966))},5966:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var r=n(7437),a=n(2265),l=n(7818),o=n(6463);n(966);var i=n(4667),s=n(357);let u=(0,l.default)(()=>Promise.all([n.e(9720),n.e(556)]).then(n.bind(n,9720)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[9720]},ssr:!1}),c=(0,l.default)(()=>Promise.all([n.e(9720),n.e(556)]).then(n.bind(n,9720)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[9720]},ssr:!1}),d=(0,l.default)(()=>Promise.all([n.e(9720),n.e(556)]).then(n.bind(n,9720)).then(e=>e.Marker),{loadableGenerated:{webpack:()=>[9720]},ssr:!1}),f=(0,l.default)(()=>Promise.all([n.e(9720),n.e(556)]).then(n.bind(n,9720)).then(e=>e.Polyline),{loadableGenerated:{webpack:()=>[9720]},ssr:!1}),h=(0,l.default)(()=>Promise.all([n.e(9720),n.e(556)]).then(n.bind(n,9720)).then(e=>e.Tooltip),{loadableGenerated:{webpack:()=>[9720]},ssr:!1}),p=s.env.NEXT_PUBLIC_ORS_API_KEY;function b(e){return n(7691).divIcon({html:'<div style="width:40px;height:40px;border-radius:50%;overflow:hidden;border:2px solid #14B8A6">\n             <img src="'.concat(e||"/avatar-fallback.png",'" style="width:100%;height:100%;object-fit:cover"/>\n           </div>'),className:"",iconSize:[40,40]})}function m(){let{jobId:e}=(0,o.useParams)(),[t,n]=(0,a.useState)(null),[l,s]=(0,a.useState)(null),[m,g]=(0,a.useState)([]),[x,j]=(0,a.useState)(null),[y,v]=(0,a.useState)(null),[w,_]=(0,a.useState)(!1);async function P(e,t){try{let n=await fetch("https://api.openrouteservice.org/v2/directions/driving-car?api_key=".concat(p,"&start=").concat(e.lng,",").concat(e.lat,"&end=").concat(t.lng,",").concat(t.lat)),r=await n.json(),a=r.features[0].geometry.coordinates.map(e=>[e[1],e[0]]);g(a);let l=r.features[0].properties.segments[0].distance,o=r.features[0].properties.segments[0].duration;v((l/1e3).toFixed(1)),j(Math.round(o/60))}catch(e){console.error("Error ruta ORS:",e)}}async function I(){if(_(!0),alert("Has marcado que llegaste al cliente \uD83D\uDE80"),e){let{error:t}=await i.supabase.from("jobs").update({status:"arrived"}).eq("id",e);t&&console.error("Error actualizando job:",t)}}return(0,a.useEffect)(()=>{(async function(){if(!e)return;let{data:t,error:n}=await i.supabase.from("jobs").select("id, status, client_lat, client_lng, worker_id").eq("id",e).single();n?console.error("Error cargando job:",n):t&&t.client_lat&&t.client_lng&&s({lat:t.client_lat,lng:t.client_lng})})()},[e]),(0,a.useEffect)(()=>{if(!navigator.geolocation)return;let t=navigator.geolocation.watchPosition(async t=>{let r={lat:t.coords.latitude,lng:t.coords.longitude};n(r),e&&await i.supabase.from("jobs").update({worker_lat:r.lat,worker_lng:r.lng,status:"on_route"}).eq("id",e),l&&P(r,l)},e=>console.error("GPS error:",e),{enableHighAccuracy:!0});return()=>navigator.geolocation.clearWatch(t)},[l,e]),(0,a.useEffect)(()=>{if(!t||!l)return;let e=setInterval(()=>P(t,l),5e3);return()=>clearInterval(e)},[t,l]),(0,r.jsxs)("div",{className:"container",children:[(0,r.jsx)("h1",{className:"text-xl font-bold mb-3",children:"Ruta hacia el cliente"}),(0,r.jsxs)("div",{style:{height:"70vh"},className:"rounded-xl overflow-hidden relative",children:[t&&l&&(0,r.jsxs)(u,{center:t,zoom:14,style:{height:"100%",width:"100%"},children:[(0,r.jsx)(c,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,r.jsx)(d,{position:t,icon:b("/avatar-worker.png"),children:(0,r.jsx)(h,{children:"Tu ubicaci\xf3n"})}),(0,r.jsx)(d,{position:l,icon:b("/avatar-client.png"),children:(0,r.jsx)(h,{children:"Cliente"})}),m.length>0&&(0,r.jsx)(f,{positions:m,pathOptions:{color:"#14B8A6",weight:5}})]}),null!==x&&null!==y&&(0,r.jsx)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-zinc-900/90 border border-white/10 rounded-2xl px-5 py-4 text-center shadow-xl w-[90%] max-w-md",children:w?(0,r.jsx)("div",{className:"text-green-400 font-semibold",children:"Has llegado al destino ✅"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"font-bold text-lg text-white",children:"\uD83D\uDE97 En camino"}),(0,r.jsxs)("div",{className:"text-sm text-white/80 mb-3",children:[y," km • ",x," min aprox"]}),(0,r.jsx)("button",{onClick:I,className:"btn btn-primary w-full py-2 rounded-lg",children:"✅ Llegu\xe9"})]})})]})]})}},4667:function(e,t,n){"use strict";n.d(t,{S:function(){return l}});var r=n(951);let a=null;function l(){if(a)return a;let e="https://ydtficoxjuxsoaxtghhj.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkdGZpY294anV4c29heHRnaGhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwOTUwNDIsImV4cCI6MjA3NTY3MTA0Mn0.KBRDCAJYvjpmcXRnYFcuSI8Mn0zYfJzaN0QJo63gzy8";if(!e||!t)throw console.error("❌ Faltan variables de entorno de Supabase."),Error("Variables de entorno Supabase no configuradas.");return a=(0,r.createBrowserClient)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),console.log("✅ Supabase (browser client) inicializado en",e),a}},7818:function(e,t,n){"use strict";n.d(t,{default:function(){return a.a}});var r=n(551),a=n.n(r)},6463:function(e,t,n){"use strict";var r=n(1169);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},551:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let r=n(9920);n(7437),n(2265);let a=r._(n(148));function l(e,t){var n;let r={loading:e=>{let{error:t,isLoading:n,pastDelay:r}=e;return null}};"function"==typeof e&&(r.loader=e);let l={...r,...t};return(0,a.default)({...l,modules:null==(n=l.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},912:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return a}});let r=n(5592);function a(e){let{reason:t,children:n}=e;if("undefined"==typeof window)throw new r.BailoutToCSRError(t);return n}},148:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return u}});let r=n(7437),a=n(2265),l=n(912),o=n(1481);function i(e){return{default:e&&"default"in e?e.default:e}}let s={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},u=function(e){let t={...s,...e},n=(0,a.lazy)(()=>t.loader().then(i)),u=t.loading;function c(e){let i=u?(0,r.jsx)(u,{isLoading:!0,pastDelay:!0,error:null}):null,s=t.ssr?(0,r.jsxs)(r.Fragment,{children:["undefined"==typeof window?(0,r.jsx)(o.PreloadCss,{moduleIds:t.modules}):null,(0,r.jsx)(n,{...e})]}):(0,r.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(a.Suspense,{fallback:i,children:s})}return c.displayName="LoadableComponent",c}},1481:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return l}});let r=n(7437),a=n(8512);function l(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let n=(0,a.getExpectedRequestStore)("next/dynamic css"),l=[];if(n.reactLoadableManifest&&t){let e=n.reactLoadableManifest;for(let n of t){if(!e[n])continue;let t=e[n].files.filter(e=>e.endsWith(".css"));l.push(...t)}}return 0===l.length?null:(0,r.jsx)(r.Fragment,{children:l.map(e=>(0,r.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:n.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},966:function(){}},function(e){e.O(0,[2733,4212,951,2971,7023,1744],function(){return e(e.s=9249)}),_N_E=e.O()}]);