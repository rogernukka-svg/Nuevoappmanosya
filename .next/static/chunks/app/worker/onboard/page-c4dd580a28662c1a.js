(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6152],{7627:function(e,l,a){Promise.resolve().then(a.bind(a,9755))},9755:function(e,l,a){"use strict";a.r(l),a.d(l,{default:function(){return d}});var r=a(7437);a(8877);var t=a(2265);let s=(0,a(4667).S)(),o=[{slug:"limpieza",name:"\uD83E\uDDF9 Limpieza"},{slug:"plomeria",name:"\uD83D\uDD27 Plomer\xeda"},{slug:"jardineria",name:"\uD83C\uDF3F Jardiner\xeda / C\xe9sped"},{slug:"electricidad",name:"⚡ Electricidad"},{slug:"auxilio-vehicular",name:"\uD83D\uDE97 Auxilio vehicular"},{slug:"fletes",name:"\uD83D\uDE9A Fletes y mudanzas"}],i=[3,5,10,15,20],n=[{value:"CI",label:"C\xe9dula de Identidad (CI)"},{value:"DNI",label:"Documento Nacional de Identidad (DNI)"},{value:"PASSPORT",label:"Pasaporte"}];function d(){let[e,l]=(0,t.useState)(null);return(0,t.useEffect)(()=>{s.auth.getUser().then(e=>{var a;let{data:r}=e;l(null!==(a=null==r?void 0:r.user)&&void 0!==a?a:null)})},[]),(0,r.jsxs)("div",{className:"container py-6",children:[(0,r.jsxs)("header",{className:"mb-8 text-center",children:[(0,r.jsx)("h1",{className:"font-heading text-3xl font-extrabold bg-gradient-to-r from-emerald-500 to-cyan-500 text-transparent bg-clip-text",children:"Activar Perfil Profesional"}),(0,r.jsxs)("p",{className:"text-gray-600 text-sm mt-2 max-w-xl mx-auto",children:["Sub\xed tu foto, eleg\xed tus oficios, defin\xed tu radio de trabajo, carg\xe1 tus documentos, complet\xe1 tus datos bancarios y empez\xe1 a recibir pedidos con ",(0,r.jsx)("b",{children:"ManosYA"}),"."]})]}),(0,r.jsx)(c,{user:e})]})}function c(e){var l,a;let{user:d}=e,[c,u]=(0,t.useState)(!0),[m,b]=(0,t.useState)(""),[g,x]=(0,t.useState)(null),[f,p]=(0,t.useState)(!1),[h,v]=(0,t.useState)(null),[y,j]=(0,t.useState)(!0),[_,N]=(0,t.useState)([]),[w,k]=(0,t.useState)(5),[C,D]=(0,t.useState)(null),[S,I]=(0,t.useState)(""),[P,E]=(0,t.useState)(""),[A,F]=(0,t.useState)("CI"),[z,J]=(0,t.useState)(""),[T,U]=(0,t.useState)(null),[O,V]=(0,t.useState)(null),[q,G]=(0,t.useState)(null),[R,Y]=(0,t.useState)(""),[B,M]=(0,t.useState)("ahorro"),[L,X]=(0,t.useState)(""),[Z,H]=(0,t.useState)(""),[Q,K]=(0,t.useState)(""),[W,$]=(0,t.useState)(!1),[ee,el]=(0,t.useState)(null),[ea,er]=(0,t.useState)(null);(0,t.useEffect)(()=>{d&&(async()=>{u(!0);try{let{data:i}=await s.from("profiles").select("full_name, avatar_url, is_verified").eq("id",d.id).maybeSingle();i&&(b(i.full_name||""),x(i.avatar_url||null),p(!!i.is_verified));let{data:n}=await s.from("reviews").select("rating").eq("worker_id",d.id);if(null==n?void 0:n.length){let e=n.reduce((e,l)=>e+((null==l?void 0:l.rating)||0),0)/n.length;v(e.toFixed(1))}let{data:c}=await s.from("worker_profiles").select("is_active, radius_km, bio, years_experience, last_lat, last_lon, skills").eq("user_id",d.id).maybeSingle();if(c){var e,l,a,r,t,o;j(null===(a=c.is_active)||void 0===a||a),k(null!==(r=c.radius_km)&&void 0!==r?r:5),I(null!==(t=c.bio)&&void 0!==t?t:""),E(null!==(o=c.years_experience)&&void 0!==o?o:""),c.last_lat&&c.last_lon&&D({lat:c.last_lat,lon:c.last_lon}),c.skills&&N(Array.isArray(c.skills)?c.skills:(null===(l=c.skills)||void 0===l?void 0:null===(e=l.split)||void 0===e?void 0:e.call(l,","))||[])}let{data:u}=await s.from("documents").select("doc_type, doc_number, front_url, back_url, file_url").eq("user_id",d.id);if(null==u?void 0:u.length){let e=u.find(e=>["CI","DNI","PASSPORT"].includes(e.doc_type));e&&(F(e.doc_type),J(e.doc_number||""),U(e.front_url||null),V(e.back_url||null));let l=u.find(e=>"POLICE"===e.doc_type);l&&G(l.file_url||null)}let{data:m}=await s.from("bank_accounts").select("bank_name, account_type, account_number, holder_name, holder_document").eq("user_id",d.id).maybeSingle();m&&(Y(m.bank_name||""),M(m.account_type||"ahorro"),X(m.account_number||""),H(m.holder_name||""),K(m.holder_document||""))}catch(e){er(e.message)}finally{u(!1)}})()},[d]);let et=(0,t.useMemo)(()=>m&&w>0,[m,w]);async function es(e){var l;let a=null===(l=e.target.files)||void 0===l?void 0:l[0];if(a&&(null==d?void 0:d.id))try{let e="".concat(d.id,"/avatar_").concat(Date.now(),".jpg"),{error:l}=await s.storage.from("avatars").upload(e,a,{cacheControl:"3600",upsert:!0});if(l)throw l;let{data:r}=s.storage.from("avatars").getPublicUrl(e),t=r.publicUrl;await s.from("profiles").update({avatar_url:t}).eq("id",d.id),x(t),el("\uD83D\uDDBC️ Foto de perfil actualizada.")}catch(e){er("No se pudo subir la foto: "+e.message)}}async function eo(){try{let e=await new Promise((e,l)=>navigator.geolocation.getCurrentPosition(l=>e({lat:l.coords.latitude,lon:l.coords.longitude}),l,{enableHighAccuracy:!0}));D(e),await s.from("worker_profiles").upsert({user_id:d.id,last_lat:e.lat,last_lon:e.lon},{onConflict:"user_id"}),el("\uD83D\uDCCD Ubicaci\xf3n guardada.")}catch(e){er("No se pudo obtener ubicaci\xf3n: "+e.message)}}async function ei(e,l){if(l&&(null==d?void 0:d.id))try{let a=l.name.split(".").pop(),r="".concat(d.id,"/").concat(e,"_").concat(Date.now(),".").concat(a),{error:t}=await s.storage.from("worker-docs").upload(r,l);if(t)throw t;let{data:o}=s.storage.from("worker-docs").getPublicUrl(r),i=o.publicUrl,n="front"===e?{front_url:i}:{back_url:i};await s.from("documents").upsert({user_id:d.id,doc_type:A,doc_number:z,...n},{onConflict:"user_id,doc_type"}),"front"===e?U(i):V(i),el("\uD83D\uDCC4 Documento subido.")}catch(e){er("No se pudo subir el documento: "+e.message)}}async function en(e){if(e&&(null==d?void 0:d.id))try{let l=e.name.split(".").pop(),a="".concat(d.id,"/police_").concat(Date.now(),".").concat(l),{error:r}=await s.storage.from("worker-docs").upload(a,e);if(r)throw r;let{data:t}=s.storage.from("worker-docs").getPublicUrl(a),o=t.publicUrl;await s.from("documents").upsert({user_id:d.id,doc_type:"POLICE",file_url:o},{onConflict:"user_id,doc_type"}),G(o),el("\uD83D\uDEE1️ Antecedente policial subido.")}catch(e){er("No se pudo subir el antecedente policial: "+e.message)}}async function ed(e){var l,a,r;if(null==e||null===(l=e.preventDefault)||void 0===l||l.call(e),null==d?void 0:d.id){$(!0),el(null),er(null);try{await s.from("profiles").update({full_name:m}).eq("id",d.id),await s.from("worker_profiles").upsert({user_id:d.id,is_active:y,radius_km:w,bio:S,years_experience:Number(P)||null,last_lat:null!==(a=null==C?void 0:C.lat)&&void 0!==a?a:null,last_lon:null!==(r=null==C?void 0:C.lon)&&void 0!==r?r:null,skills:_},{onConflict:"user_id"}),z&&await s.from("documents").upsert({user_id:d.id,doc_type:A,doc_number:z,front_url:T,back_url:O},{onConflict:"user_id,doc_type"}),await s.from("bank_accounts").upsert({user_id:d.id,bank_name:R||null,account_type:B||null,account_number:L||null,holder_name:Z||null,holder_document:Q||null},{onConflict:"user_id"}),el("✅ Perfil guardado y activado correctamente.")}catch(e){er("❌ "+(e.message||e))}finally{$(!1)}}}return c?(0,r.jsx)("div",{className:"text-center py-10 text-gray-500",children:"Cargando perfil profesional..."}):(0,r.jsxs)("form",{onSubmit:ed,className:"space-y-8 max-w-2xl mx-auto bg-[#f9fafb] py-6 px-3 rounded-2xl",children:[(0,r.jsxs)("section",{className:"bg-white border border-gray-200 shadow-sm rounded-xl p-6",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-700 border-l-4 border-emerald-500 pl-3 mb-4",children:"Tu perfil"}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,r.jsx)("img",{src:g||"/avatar-fallback.png",alt:"avatar",className:"w-24 h-24 rounded-full border-4 border-emerald-500 object-cover"}),(0,r.jsxs)("label",{className:"text-sm text-emerald-600 cursor-pointer font-medium",children:["Cambiar foto",(0,r.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:es})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Nombre y apellido"}),(0,r.jsx)("input",{className:"w-full border rounded-lg p-2 bg-gray-50 focus:ring-2 focus:ring-emerald-500 outline-none",value:m,onChange:e=>b(e.target.value),placeholder:"Ej: Juan P\xe9rez"})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 mt-3",children:[f&&(0,r.jsx)("span",{className:"bg-emerald-600/15 text-emerald-700 px-3 py-1 rounded-full text-xs font-semibold",children:"✓ Perfil verificado"}),h&&(0,r.jsxs)("span",{className:"bg-yellow-400/15 text-yellow-700 px-3 py-1 rounded-full text-xs font-semibold",children:["⭐ ",h,"/5"]})]})]}),(0,r.jsxs)("section",{className:"bg-white border border-gray-200 shadow-sm rounded-xl p-6",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-700 border-l-4 border-emerald-500 pl-3 mb-4",children:"Tus oficios"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:o.map(e=>{let l=_.includes(e.slug);return(0,r.jsx)("button",{type:"button",onClick:()=>N(l?_.filter(l=>l!==e.slug):[..._,e.slug]),className:"px-3 py-2 rounded-lg border text-sm font-medium transition ".concat(l?"bg-emerald-500 text-white border-emerald-500":"border-gray-300 text-gray-700 hover:bg-gray-100"),children:e.name},e.slug)})}),(0,r.jsxs)("div",{className:"mt-5 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Radio de trabajo"}),(0,r.jsx)("select",{value:w,onChange:e=>k(Number(e.target.value)),className:"w-full border rounded-lg p-2 bg-gray-50 focus:ring-2 focus:ring-emerald-500",children:i.map(e=>(0,r.jsxs)("option",{value:e,children:[e," km"]},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Estado"}),(0,r.jsxs)("select",{value:y?"activo":"inactivo",onChange:e=>j("activo"===e.target.value),className:"w-full border rounded-lg p-2 bg-gray-50 focus:ring-2 focus:ring-emerald-500",children:[(0,r.jsx)("option",{value:"activo",children:"✅ Disponible"}),(0,r.jsx)("option",{value:"inactivo",children:"⏸️ Pausado"})]})]})]})]}),(0,r.jsxs)("section",{className:"bg-white border border-gray-200 shadow-sm rounded-xl p-6",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-700 border-l-4 border-emerald-500 pl-3 mb-4",children:"Tu ubicaci\xf3n"}),(0,r.jsx)("button",{type:"button",onClick:eo,className:"text-sm font-semibold text-emerald-600 hover:text-emerald-700",children:"Guardar ubicaci\xf3n actual"}),C&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["\uD83D\uDCCD Lat: ",null===(l=C.lat)||void 0===l?void 0:l.toFixed(4)," \xb7 Lon: ",null===(a=C.lon)||void 0===a?void 0:a.toFixed(4)]})]}),(0,r.jsxs)("section",{className:"bg-white border border-gray-200 shadow-sm rounded-xl p-6",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-700 border-l-4 border-emerald-500 pl-3 mb-4",children:"Sobre vos"}),(0,r.jsx)("textarea",{rows:3,className:"w-full border rounded-lg p-2 bg-gray-50 focus:ring-2 focus:ring-emerald-500",value:S,onChange:e=>I(e.target.value),placeholder:"Contanos un poco sobre tu experiencia..."}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"A\xf1os de experiencia"}),(0,r.jsx)("input",{type:"number",min:0,className:"w-full border rounded-lg p-2 bg-gray-50 focus:ring-2 focus:ring-emerald-500",value:P,onChange:e=>E(e.target.value)})]})]}),(0,r.jsxs)("section",{className:"bg-white border border-gray-200 shadow-sm rounded-xl p-6",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-700 border-l-4 border-emerald-500 pl-3 mb-4",children:"Verificaci\xf3n de identidad"}),(0,r.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Tipo de documento"}),(0,r.jsx)("select",{value:A,onChange:e=>F(e.target.value),className:"w-full border rounded-lg p-2 bg-gray-50 focus:ring-2 focus:ring-emerald-500",children:n.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"N\xfamero"}),(0,r.jsx)("input",{className:"w-full border rounded-lg p-2 bg-gray-50 focus:ring-2 focus:ring-emerald-500",value:z,onChange:e=>J(e.target.value),placeholder:"Ej: 12345678"})]})]}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Frente"}),(0,r.jsxs)("label",{className:"text-sm text-emerald-600 cursor-pointer font-medium",children:["Subir frente",(0,r.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{var l;return ei("front",null===(l=e.target.files)||void 0===l?void 0:l[0])}})]}),T&&(0,r.jsx)("a",{href:T,target:"_blank",className:"block text-emerald-600 text-xs underline mt-1",children:"Ver archivo"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Dorso"}),(0,r.jsxs)("label",{className:"text-sm text-emerald-600 cursor-pointer font-medium",children:["Subir dorso",(0,r.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{var l;return ei("back",null===(l=e.target.files)||void 0===l?void 0:l[0])}})]}),O&&(0,r.jsx)("a",{href:O,target:"_blank",className:"block text-emerald-600 text-xs underline mt-1",children:"Ver archivo"})]})]}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Antecedente policial (PDF/JPG/PNG)"}),(0,r.jsxs)("label",{className:"text-sm text-emerald-600 cursor-pointer font-medium",children:["Subir archivo",(0,r.jsx)("input",{type:"file",hidden:!0,accept:"application/pdf,image/*",onChange:e=>{var l;return en(null===(l=e.target.files)||void 0===l?void 0:l[0])}})]}),q&&(0,r.jsx)("a",{href:q,target:"_blank",className:"block text-emerald-600 text-xs underline mt-1",children:"Ver archivo"})]})]}),(0,r.jsxs)("section",{className:"bg-white border border-gray-200 shadow-sm rounded-xl p-6",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-700 border-l-4 border-emerald-500 pl-3 mb-4",children:"Datos bancarios (para cobros)"}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Banco"}),(0,r.jsx)("input",{className:"w-full border rounded-lg p-2 bg-gray-50 focus:ring-2 focus:ring-emerald-500",value:R,onChange:e=>Y(e.target.value),placeholder:"Ej: Ita\xfa, Visi\xf3n, BBVA..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Tipo de cuenta"}),(0,r.jsxs)("select",{value:B,onChange:e=>M(e.target.value),className:"w-full border rounded-lg p-2 bg-gray-50 focus:ring-2 focus:ring-emerald-500",children:[(0,r.jsx)("option",{value:"ahorro",children:"Caja de ahorro"}),(0,r.jsx)("option",{value:"corriente",children:"Cuenta corriente"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"N\xfamero / Alias"}),(0,r.jsx)("input",{className:"w-full border rounded-lg p-2 bg-gray-50 focus:ring-2 focus:ring-emerald-500",value:L,onChange:e=>X(e.target.value),placeholder:"N\xfamero de cuenta o alias"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Titular de la cuenta"}),(0,r.jsx)("input",{className:"w-full border rounded-lg p-2 bg-gray-50 focus:ring-2 focus:ring-emerald-500",value:Z,onChange:e=>H(e.target.value),placeholder:"Nombre y apellido"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Documento del titular"}),(0,r.jsx)("input",{className:"w-full border rounded-lg p-2 bg-gray-50 focus:ring-2 focus:ring-emerald-500",value:Q,onChange:e=>K(e.target.value),placeholder:"CI / DNI / Pasaporte del titular"})]})]})]}),ee&&(0,r.jsx)("div",{className:"text-emerald-600 text-sm",children:ee}),ea&&(0,r.jsx)("div",{className:"text-red-500 text-sm",children:ea}),(0,r.jsx)("button",{type:"submit",className:"w-full py-3 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-xl shadow transition",disabled:!et||W,children:W?"Guardando...":"✅ Guardar y activar perfil"})]})}},4667:function(e,l,a){"use strict";a.d(l,{S:function(){return s}});var r=a(951);let t=null;function s(){if(t)return t;let e="https://ydtficoxjuxsoaxtghhj.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkdGZpY294anV4c29heHRnaGhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwOTUwNDIsImV4cCI6MjA3NTY3MTA0Mn0.KBRDCAJYvjpmcXRnYFcuSI8Mn0zYfJzaN0QJo63gzy8";if(!e||!l)throw console.error("❌ Faltan variables de entorno de Supabase."),Error("Variables de entorno Supabase no configuradas.");return t=(0,r.createBrowserClient)(e,l,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),console.log("✅ Supabase (browser client) inicializado en",e),t}},8877:function(){}},function(e){e.O(0,[404,951,2971,7023,1744],function(){return e(e.s=7627)}),_N_E=e.O()}]);