(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7576],{589:function(e,t,n){Promise.resolve().then(n.bind(n,6627))},6627:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(7437),a=n(2265),s=n(4667),i=n(6463),c=n(3763),o=n(518),u=n(7091);let l=(0,s.S)();function d(){let{chatId:e}=(0,i.useParams)(),t=(0,i.useRouter)(),[n,s]=(0,a.useState)(null),[d,f]=(0,a.useState)([]),[m,h]=(0,a.useState)(!1),x=(0,a.useRef)(null),b=(0,a.useRef)(null);async function p(t){var r;if(t.preventDefault(),!(null==n?void 0:n.id)||!e)return;let a=null===(r=x.current)||void 0===r?void 0:r.value.trim();a&&(h(!0),await l.from("messages").insert([{chat_id:e,sender_id:n.id,content:a}]),h(!1),x.current.value="")}return(0,a.useEffect)(()=>{l.auth.getUser().then(e=>{let{data:n}=e;(null==n?void 0:n.user)?s(n.user):t.replace("/login")})},[t]),(0,a.useEffect)(()=>{e&&(async()=>{let{data:t}=await l.from("messages").select("*").eq("chat_id",e).order("created_at",{ascending:!0});f(t||[])})()},[e]),(0,a.useEffect)(()=>{if(!e)return;let t=l.channel("chat-".concat(e)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"chat_id=eq.".concat(e)},e=>f(t=>[...t,e.new])).subscribe();return b.current=t,()=>l.removeChannel(t)},[e]),(0,r.jsxs)(c.E.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col min-h-screen bg-white text-gray-900",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-gray-50",children:[(0,r.jsxs)("button",{onClick:()=>t.back(),className:"flex items-center gap-1 text-gray-600 hover:text-emerald-600",children:[(0,r.jsx)(o.Z,{size:18})," Volver"]}),(0,r.jsx)("h2",{className:"font-bold text-emerald-600",children:"Chat con cliente"}),(0,r.jsx)("div",{className:"w-6"})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-2",children:d.map(e=>{let t=e.sender_id===(null==n?void 0:n.id);return(0,r.jsx)("div",{className:"flex ".concat(t?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-[80%] px-3 py-2 rounded-2xl text-sm shadow-sm ".concat(t?"bg-emerald-500 text-white rounded-br-md":"bg-gray-100 text-gray-800 rounded-bl-md"),children:[e.content,(0,r.jsx)("div",{className:"text-[10px] mt-1 opacity-70 ".concat(t?"text-white":"text-gray-500"),children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id)})}),(0,r.jsxs)("form",{onSubmit:p,className:"p-3 border-t border-gray-100 flex gap-2 bg-white",children:[(0,r.jsx)("input",{ref:x,type:"text",placeholder:"Escrib\xed un mensaje…",className:"flex-1 bg-gray-100 rounded-xl px-3 py-3 outline-none focus:ring-2 focus:ring-emerald-400 border border-gray-200"}),(0,r.jsx)("button",{disabled:m,className:"px-4 rounded-xl bg-emerald-500 text-white font-semibold hover:bg-emerald-600 transition disabled:opacity-60",children:(0,r.jsx)(u.Z,{size:18})})]})]})}},4667:function(e,t,n){"use strict";n.d(t,{S:function(){return s}});var r=n(951);let a=null;function s(){if(a)return a;let e="https://ydtficoxjuxsoaxtghhj.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkdGZpY294anV4c29heHRnaGhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwOTUwNDIsImV4cCI6MjA3NTY3MTA0Mn0.KBRDCAJYvjpmcXRnYFcuSI8Mn0zYfJzaN0QJo63gzy8";if(!e||!t)throw console.error("❌ Faltan variables de entorno de Supabase."),Error("Variables de entorno Supabase no configuradas.");return a=(0,r.createBrowserClient)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),console.log("✅ Supabase (browser client) inicializado en",e),a}},518:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8030).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},7091:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8030).Z)("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]])},6463:function(e,t,n){"use strict";var r=n(1169);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})}},function(e){e.O(0,[951,3642,2971,7023,1744],function(){return e(e.s=589)}),_N_E=e.O()}]);