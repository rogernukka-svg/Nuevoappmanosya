(()=>{var e={};e.id=876,e.ids=[876],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},802:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),r(6168),r(9884),r(2309),r(5866);var s=r(3191),a=r(8716),n=r(7922),i=r.n(n),l=r(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let c=["",{children:["client",{children:["jobs",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,6168)),"D:\\CARPETA ROGER\\CONESTESOYBILLONARIOYALOSOY\\jobs-mvp-next-pro-main\\app\\client\\jobs\\page.jsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,9884)),"D:\\CARPETA ROGER\\CONESTESOYBILLONARIOYALOSOY\\jobs-mvp-next-pro-main\\app\\client\\layout.jsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,2309)),"D:\\CARPETA ROGER\\CONESTESOYBILLONARIOYALOSOY\\jobs-mvp-next-pro-main\\app\\layout.jsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],d=["D:\\CARPETA ROGER\\CONESTESOYBILLONARIOYALOSOY\\jobs-mvp-next-pro-main\\app\\client\\jobs\\page.jsx"],u="/client/jobs/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/client/jobs/page",pathname:"/client/jobs",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},6189:(e,t,r)=>{Promise.resolve().then(r.bind(r,4317))},4317:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j});var s=r(326),a=r(7577),n=r(3170),i=r(5795),l=r(9086),o=r(9734),c=r(7506),d=r(1856),u=r(2881);let m=(0,u.Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var p=r(3734),x=r(6307);let h=(0,u.Z)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);var f=r(1890),g=r(939),y=r(5999);let b=(0,n.S)();function j(){let[e,t]=(0,a.useState)(null),[r,n]=(0,a.useState)([]),[u,j]=(0,a.useState)(!0),[v,w]=(0,a.useState)([]),[N,_]=(0,a.useState)(!1),[E,C]=(0,a.useState)(null),[A,O]=(0,a.useState)(!1),R=(0,a.useRef)(null),S=(0,a.useRef)(null),k=(0,a.useRef)(null),D=(0,a.useRef)(null),[P,L]=(0,a.useState)(!1),[q,M]=(0,a.useState)(0),[I,Z]=(0,a.useState)("");async function T(){if(!e?.id)return;j(!0);let{data:t,error:r}=await b.from("jobs").select(`
        *,
        worker:profiles!worker_id(full_name, avatar_url),
        review:reviews!job_id(rating, comment, created_at)
      `).eq("client_id",e.id).order("created_at",{ascending:!1});r?(console.error("❌ Error cargando pedidos:",r),y.A.error("Error al cargar pedidos")):n(t||[]),j(!1)}async function Y(t){try{if(!t?.worker_id)return(0,y.A)("⚠️ A\xfan no tiene trabajador asignado");let{data:r,error:s}=await b.rpc("ensure_chat_for_job",{p_job_id:t.id});if(s)throw s;let{data:a}=await b.from("messages").select("*").eq("chat_id",r).order("created_at",{ascending:!0});w(a||[]),C({...t,chat_id:r}),_(!0),S.current&&b.removeChannel(S.current);let n=b.channel(`chat-${r}`,{config:{broadcast:{self:!0},presence:{key:e.id}}}).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`chat_id=eq.${r}`},t=>{w(e=>[...e,t.new]),t.new.sender_id!==e.id&&D.current?.play?.(),setTimeout(()=>k.current?.scrollIntoView({behavior:"smooth"}),200)}).subscribe(async e=>{"SUBSCRIBED"===e&&console.log(`✅ Realtime conectado al chat ${r}`)});S.current=n}catch(e){console.error("❌ Error abriendo chat:",e),y.A.error("No se pudo abrir el chat")}}async function z(t){let r=(t||"").trim();if(r&&e?.id&&E)try{O(!0);let{error:t}=await b.from("messages").insert([{chat_id:E.chat_id,sender_id:e.id,content:r}]);if(t)throw t}catch(e){y.A.error("No se pudo enviar el mensaje")}finally{O(!1),setTimeout(()=>k.current?.scrollIntoView({behavior:"smooth"}),200)}}async function $(t,r){if(!q)return(0,y.A)("Seleccion\xe1 una calificaci\xf3n");try{let{error:s}=await b.rpc("add_review_if_valid",{p_job_id:t,p_worker_id:r,p_client_id:e.id,p_rating:q,p_comment:I});if(s)throw s;y.A.success("✅ Calificaci\xf3n enviada"),L(!1),M(0),Z(""),await T()}catch(e){console.error("❌ Error RPC:",e),y.A.error("Error enviando review")}}async function G(e){try{let{error:t}=await b.rpc("reassign_worker_if_needed",{p_job_id:e});if(t)throw t;y.A.success("\uD83D\uDD04 Trabajador reasignado correctamente"),await T()}catch(e){y.A.error("No se pudo reasignar autom\xe1ticamente")}}return(0,s.jsxs)(i.E.div,{initial:{opacity:0},animate:{opacity:1},className:"container max-w-screen-md mx-auto px-4 pb-32 bg-white text-gray-900 min-h-screen relative",children:[(0,s.jsxs)("h1",{className:"text-2xl font-extrabold text-emerald-600 pt-8 mb-4 flex items-center gap-2",children:[s.jsx(o.Z,{className:"text-emerald-600"})," Panel de Pedidos"]}),s.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Gestion\xe1 tus servicios activos, completados y planificados f\xe1cilmente ⚡"}),u?(0,s.jsxs)("div",{className:"flex justify-center mt-10 text-gray-400 gap-2 items-center",children:[s.jsx(c.Z,{className:"animate-spin"})," Cargando tus pedidos..."]}):0===r.length?s.jsx("p",{className:"text-center text-gray-500 mt-10",children:"No ten\xe9s pedidos a\xfan. \xa1Comenz\xe1 solicitando tu primer servicio! \uD83D\uDCAA"}):s.jsx("section",{className:"grid gap-4 mt-5",children:r.map(e=>{let t=e.review?.[0];return(0,s.jsxs)(i.E.div,{whileHover:{scale:1.01},className:"border rounded-2xl p-5 shadow-sm bg-white hover:shadow-md transition relative",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"font-bold text-gray-800",children:e.title}),s.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.description}),(0,s.jsxs)("p",{className:"text-xs text-emerald-600 font-medium mt-1",children:[s.jsx(d.Z,{className:"inline w-3 h-3 mr-1"}),new Date(e.created_at).toLocaleDateString()]})]}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-lg font-semibold ${"completed"===e.status?"bg-green-100 text-green-700":"cancelled"===e.status?"bg-red-100 text-red-600":"assigned"===e.status?"bg-blue-100 text-blue-700":"bg-emerald-50 text-emerald-700"}`,children:e.status})]}),e.worker&&(0,s.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["\uD83D\uDC77 ",e.worker.full_name||"Asignado autom\xe1ticamente"]}),"assigned"===e.status&&(0,s.jsxs)("button",{onClick:()=>G(e.id),className:"flex items-center gap-2 mt-2 text-sm text-emerald-600 font-medium hover:text-emerald-700 transition",children:[s.jsx(m,{size:14})," Reasignar trabajador autom\xe1ticamente"]}),t?(0,s.jsxs)("div",{className:"mt-3 p-3 bg-emerald-50 rounded-xl text-sm border border-emerald-100",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[[...Array(t.rating)].map((e,t)=>s.jsx(p.Z,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"},t)),s.jsx(x.Z,{className:"w-4 h-4 text-emerald-500 ml-1"})]}),(0,s.jsxs)("p",{className:"italic text-gray-600",children:['"',t.comment,'"']}),(0,s.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Calificado el ",new Date(t.created_at).toLocaleDateString()]})]}):"completed"===e.status&&s.jsx("button",{onClick:()=>{C(e),L(!0)},className:"mt-3 w-full py-2 rounded-xl bg-emerald-500 text-white font-semibold hover:bg-emerald-600 transition",children:"\uD83C\uDF1F Calificar servicio"}),e.worker_id&&(0,s.jsxs)("button",{onClick:()=>Y(e),className:"flex items-center justify-center gap-2 w-full mt-3 bg-gray-100 text-gray-800 py-2 rounded-xl font-semibold hover:bg-gray-200 transition",children:[s.jsx(h,{size:18})," Chat con trabajador"]})]},e.id)})}),s.jsx(l.M,{children:N&&s.jsx(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[99999] flex justify-center items-end bg-black/70",children:(0,s.jsxs)(i.E.div,{initial:{y:300},animate:{y:0},exit:{y:300},transition:{type:"spring",stiffness:120},className:"bg-white w-full max-w-md rounded-t-3xl shadow-2xl flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[(0,s.jsxs)("button",{onClick:function(){_(!1),S.current&&(b.removeChannel(S.current),S.current=null)},className:"flex items-center gap-1 text-gray-600 hover:text-red-500",children:[s.jsx(f.Z,{size:18})," Volver"]}),s.jsx("h2",{className:"font-semibold text-gray-800",children:"Chat en vivo \uD83D\uDCAC"}),s.jsx("div",{className:"w-6"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-2 bg-white",children:[0===v.length?s.jsx("p",{className:"text-center text-gray-400 mt-6",children:"No hay mensajes a\xfan \uD83D\uDCED"}):v.map(t=>{let r=t.sender_id===e?.id;return s.jsx("div",{className:`flex ${r?"justify-end":"justify-start"}`,children:s.jsx("div",{className:`max-w-[80%] px-3 py-2 rounded-2xl text-sm shadow-sm ${r?"bg-emerald-500 text-white":"bg-gray-100 text-gray-800"}`,children:t.content})},t.id)}),s.jsx("div",{ref:k})]}),(0,s.jsxs)("form",{onSubmit:async e=>{e.preventDefault();let t=R.current?.value||"";await z(t),R.current&&(R.current.value="")},className:"flex gap-2 p-3 border-t border-gray-100 bg-gray-50",children:[s.jsx("input",{ref:R,type:"text",placeholder:"Escrib\xed un mensaje…",className:"flex-1 bg-gray-100 rounded-xl px-3 py-3 outline-none focus:ring-2 focus:ring-emerald-400 border border-gray-200"}),s.jsx("button",{disabled:A,className:"px-4 rounded-xl bg-emerald-500 text-white hover:bg-emerald-600 transition disabled:opacity-60",children:s.jsx(g.Z,{size:18})})]})]})})}),s.jsx(l.M,{children:P&&E&&s.jsx(i.E.div,{className:"fixed inset-0 bg-black/60 flex justify-center items-center z-[99999]",initial:{opacity:0},animate:{opacity:1},children:(0,s.jsxs)(i.E.div,{className:"bg-white rounded-2xl shadow-2xl p-6 w-[90%] max-w-md text-center",initial:{scale:.9},animate:{scale:1},children:[(0,s.jsxs)("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:["\uD83C\uDF1F \xbfC\xf3mo fue el servicio de ",E.worker?.full_name,"?"]}),s.jsx("div",{className:"flex justify-center gap-2 mb-4",children:[1,2,3,4,5].map(e=>s.jsx(p.Z,{onClick:()=>M(e),className:`w-8 h-8 cursor-pointer transition ${e<=q?"text-yellow-400 fill-yellow-400 scale-110":"text-gray-300 hover:text-yellow-300"}`},e))}),s.jsx("textarea",{value:I,onChange:e=>Z(e.target.value),placeholder:"Dej\xe1 un comentario (opcional)",className:"w-full border border-gray-300 rounded-xl p-3 text-sm focus:ring-2 focus:ring-emerald-400 outline-none"}),(0,s.jsxs)("div",{className:"flex gap-3 mt-5",children:[s.jsx("button",{onClick:()=>L(!1),className:"flex-1 bg-gray-200 text-gray-700 rounded-xl py-2 font-semibold hover:bg-gray-300",children:"Cancelar"}),s.jsx("button",{onClick:()=>$(E.id,E.worker_id),className:"flex-1 bg-emerald-500 text-white rounded-xl py-2 font-semibold hover:bg-emerald-600",children:"Enviar"})]})]})})})]})}},1890:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(2881).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},6307:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(2881).Z)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},7506:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(2881).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},939:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(2881).Z)("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]])},3734:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(2881).Z)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])},6168:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>l});var s=r(8570);let a=(0,s.createProxy)(String.raw`D:\CARPETA ROGER\CONESTESOYBILLONARIOYALOSOY\jobs-mvp-next-pro-main\app\client\jobs\page.jsx`),{__esModule:n,$$typeof:i}=a;a.default;let l=(0,s.createProxy)(String.raw`D:\CARPETA ROGER\CONESTESOYBILLONARIOYALOSOY\jobs-mvp-next-pro-main\app\client\jobs\page.jsx#default`)},9086:(e,t,r)=>{"use strict";r.d(t,{M:()=>b});var s=r(326),a=r(7577),n=r(339),i=r(7977),l=r(2482),o=r(295),c=r(9539),d=r(3965);function u(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class m extends a.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,r=(0,c.R)(e)&&e.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=r-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function p({children:e,isPresent:t,anchorX:r,root:n}){let i=(0,a.useId)(),l=(0,a.useRef)(null),o=(0,a.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=(0,a.useContext)(d._),p=function(...e){return a.useCallback(function(...e){return t=>{let r=!1,s=e.map(e=>{let s=u(e,t);return r||"function"!=typeof s||(r=!0),s});if(r)return()=>{for(let t=0;t<s.length;t++){let r=s[t];"function"==typeof r?r():u(e[t],null)}}}}(...e),e)}(l,e?.ref);return(0,a.useInsertionEffect)(()=>{let{width:e,height:s,top:a,left:d,right:u}=o.current;if(t||!l.current||!e||!s)return;let m="left"===r?`left: ${d}`:`right: ${u}`;l.current.dataset.motionPopId=i;let p=document.createElement("style");c&&(p.nonce=c);let x=n??document.head;return x.appendChild(p),p.sheet&&p.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${s}px !important;
            ${m}px !important;
            top: ${a}px !important;
          }
        `),()=>{x.contains(p)&&x.removeChild(p)}},[t]),(0,s.jsx)(m,{isPresent:t,childRef:l,sizeRef:o,children:a.cloneElement(e,{ref:p})})}let x=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:l,presenceAffectsLayout:c,mode:d,anchorX:u,root:m})=>{let x=(0,i.h)(h),f=(0,a.useId)(),g=!0,y=(0,a.useMemo)(()=>(g=!1,{id:f,initial:t,isPresent:r,custom:l,onExitComplete:e=>{for(let t of(x.set(e,!0),x.values()))if(!t)return;n&&n()},register:e=>(x.set(e,!1),()=>x.delete(e))}),[r,x,n]);return c&&g&&(y={...y}),(0,a.useMemo)(()=>{x.forEach((e,t)=>x.set(t,!1))},[r]),a.useEffect(()=>{r||x.size||!n||n()},[r]),"popLayout"===d&&(e=(0,s.jsx)(p,{isPresent:r,anchorX:u,root:m,children:e})),(0,s.jsx)(o.O.Provider,{value:y,children:e})};function h(){return new Map}var f=r(6933);let g=e=>e.key||"";function y(e){let t=[];return a.Children.forEach(e,e=>{(0,a.isValidElement)(e)&&t.push(e)}),t}let b=({children:e,custom:t,initial:r=!0,onExitComplete:o,presenceAffectsLayout:c=!0,mode:d="sync",propagate:u=!1,anchorX:m="left",root:p})=>{let[h,b]=(0,f.oO)(u),j=(0,a.useMemo)(()=>y(e),[e]),v=u&&!h?[]:j.map(g),w=(0,a.useRef)(!0),N=(0,a.useRef)(j),_=(0,i.h)(()=>new Map),[E,C]=(0,a.useState)(j),[A,O]=(0,a.useState)(j);(0,l.L)(()=>{w.current=!1,N.current=j;for(let e=0;e<A.length;e++){let t=g(A[e]);v.includes(t)?_.delete(t):!0!==_.get(t)&&_.set(t,!1)}},[A,v.length,v.join("-")]);let R=[];if(j!==E){let e=[...j];for(let t=0;t<A.length;t++){let r=A[t],s=g(r);v.includes(s)||(e.splice(t,0,r),R.push(r))}return"wait"===d&&R.length&&(e=R),O(y(e)),C(j),null}let{forceRender:S}=(0,a.useContext)(n.p);return(0,s.jsx)(s.Fragment,{children:A.map(e=>{let a=g(e),n=(!u||!!h)&&(j===A||v.includes(a));return(0,s.jsx)(x,{isPresent:n,initial:(!w.current||!!r)&&void 0,custom:t,presenceAffectsLayout:c,mode:d,root:p,onExitComplete:n?void 0:()=>{if(!_.has(a))return;_.set(a,!0);let e=!0;_.forEach(t=>{t||(e=!1)}),e&&(S?.(),O(N.current),u&&b?.(),o&&o())},anchorX:m,children:e},a)})})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,606,163,259],()=>r(802));module.exports=s})();