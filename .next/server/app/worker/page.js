(()=>{var e={};e.id=706,e.ids=[706],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},9801:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c}),r(771),r(469),r(2309),r(5866);var s=r(3191),a=r(8716),n=r(7922),i=r.n(n),l=r(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let c=["",{children:["worker",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,771)),"D:\\CARPETA ROGER\\CONESTESOYBILLONARIOYALOSOY\\jobs-mvp-next-pro-main\\app\\worker\\page.jsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,469)),"D:\\CARPETA ROGER\\CONESTESOYBILLONARIOYALOSOY\\jobs-mvp-next-pro-main\\app\\worker\\layout.jsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,2309)),"D:\\CARPETA ROGER\\CONESTESOYBILLONARIOYALOSOY\\jobs-mvp-next-pro-main\\app\\layout.jsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],d=["D:\\CARPETA ROGER\\CONESTESOYBILLONARIOYALOSOY\\jobs-mvp-next-pro-main\\app\\worker\\page.jsx"],u="/worker/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/worker/page",pathname:"/worker",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4894:(e,t,r)=>{Promise.resolve().then(r.bind(r,8771))},8771:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var s=r(326),a=r(7577),n=r(5047),i=r(5795),l=r(9086),o=r(2881);let c=(0,o.Z)("power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),d=(0,o.Z)("circle-arrow-left",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m12 8-4 4 4 4",key:"15vm53"}],["path",{d:"M16 12H8",key:"1fr5h0"}]]);var u=r(7506);let p=(0,o.Z)("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),m=(0,o.Z)("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var x=r(1890),h=r(939);let f=(0,o.Z)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);var g=r(9730),b=r(2382),y=r(5999);let j=(0,r(3170).S)();function w(){let e=(0,n.useRouter)(),[t,r]=(0,a.useState)(null),[o,w]=(0,a.useState)([]),[v,_]=(0,a.useState)(!0),[N,k]=(0,a.useState)(null),[E,A]=(0,a.useState)([]),[C,O]=(0,a.useState)(!1),[R,S]=(0,a.useState)(!1),[P,z]=(0,a.useState)(!0),[D,M]=(0,a.useState)(!1),T=(0,a.useRef)(null),L=(0,a.useRef)(null),$=(0,a.useRef)(null),q=(0,a.useRef)(null);async function Z(){try{let e=!P;z(e),await j.from("worker_profiles").update({is_active:e}).eq("user_id",t.id),y.A.success(e?"\uD83D\uDFE2 Ahora est\xe1s disponible":"\uD83D\uDD34 Est\xe1s pausado")}catch{y.A.error("No se pudo cambiar tu estado")}}async function I(e){try{if("open"!==e.status)return y.A.warning("Este trabajo ya fue tomado");let{data:r,error:s}=await j.rpc("accept_job_flow",{p_job_id:e.id,p_worker_id:t.id});if(s||!r?.ok)throw s||Error(r?.message||"No se pudo aceptar el trabajo");y.A.success("✅ Trabajo aceptado correctamente"),w(t=>t.map(t=>t.id===e.id?{...t,status:r.status||"accepted"}:t)),await V(e),window.open(`https://www.google.com/maps/dir/?api=1&destination=${e.client_lat},${e.client_lng}`,"_blank")}catch(e){y.A.error(e.message||"No se pudo aceptar el trabajo")}}async function Y(e){try{let{data:r,error:s}=await j.rpc("reject_job_flow",{p_job_id:e.id,p_worker_id:t.id});if(s)throw s;if(!r?.ok)return y.A.warning(r?.message||"No se pudo rechazar");y.A.success("\uD83D\uDEAB Trabajo rechazado correctamente"),w(t=>t.filter(t=>t.id!==e.id))}catch(e){y.A.error(e.message||"No se pudo rechazar el trabajo")}}async function G(e){try{let{data:r,error:s}=await j.rpc("complete_job_flow",{p_job_id:e.id,p_worker_id:t.id});if(s)throw s;if(!r?.ok)return y.A.warning(r?.message||"No se pudo finalizar");y.A.success("\uD83C\uDF89 Trabajo finalizado correctamente"),w(t=>t.map(t=>t.id===e.id?{...t,status:"completed"}:t)),k(null),O(!1)}catch(e){y.A.error(e.message||"No se pudo finalizar el trabajo")}}async function V(e){try{let{data:r,error:s}=await j.rpc("ensure_chat_for_job",{p_job_id:e.id});if(s)throw s;let{data:a}=await j.from("messages").select("*").eq("chat_id",r).order("created_at",{ascending:!0});A(a||[]),O(!0),k({...e,chat_id:r}),L.current&&j.removeChannel(L.current);let n=j.channel(`chat-${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`chat_id=eq.${r}`},e=>{A(t=>[...t,e.new]),e.new.sender_id!==t.id&&q.current?.play?.(),setTimeout(()=>$.current?.scrollIntoView({behavior:"smooth"}),200)}).subscribe();L.current=n}catch{y.A.error("No se pudo abrir el chat")}}async function B(e){let r=(e||"").trim();if(r&&N)try{S(!0),await j.from("messages").insert([{chat_id:N.chat_id,sender_id:t.id,content:r}])}finally{S(!1),setTimeout(()=>$.current?.scrollIntoView({behavior:"smooth"}),200)}}return(0,s.jsxs)(i.E.div,{initial:{opacity:0},animate:{opacity:1},className:"container max-w-screen-md mx-auto px-4 pb-28 bg-white text-gray-900 min-h-screen",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4 pt-6",children:[s.jsx("h1",{className:"text-lg font-extrabold text-emerald-600",children:"Panel del Trabajador"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("button",{onClick:Z,className:`flex items-center gap-1 text-sm font-semibold ${P?"text-emerald-600 hover:text-emerald-800":"text-gray-400 hover:text-red-500"} transition`,children:[s.jsx(c,{size:16})," ",P?"Disponible":"Pausado"]}),(0,s.jsxs)("button",{onClick:()=>e.push("/role-selector"),className:"flex items-center gap-1 text-sm font-semibold text-gray-400 hover:text-emerald-500 transition",children:[s.jsx(d,{size:16})," Volver al inicio"]})]})]}),v?(0,s.jsxs)("div",{className:"flex justify-center mt-10 text-gray-400",children:[s.jsx(u.Z,{className:"animate-spin"})," Cargando trabajos..."]}):0===o.length?s.jsx("p",{className:"text-gray-500 mt-10 text-center",children:"A\xfan no ten\xe9s solicitudes disponibles."}):s.jsx("section",{className:"grid gap-3 mt-5",children:o.map(e=>(0,s.jsxs)(i.E.div,{whileTap:{scale:.98},className:"border rounded-2xl p-4 transition shadow-sm bg-white hover:shadow-md",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"font-bold text-gray-800",children:e.title||"Trabajo de Servicio"}),s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${"open"===e.status?"bg-yellow-100 text-yellow-700":"accepted"===e.status?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:"open"===e.status?"Disponible":"accepted"===e.status?"En curso":"Completado"})]}),s.jsx("p",{className:"text-sm text-gray-600",children:e.description||"Pedido generado desde el mapa"}),e.client&&(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[s.jsx("img",{src:e.client?.avatar_url||"/avatar-fallback.png",alt:e.client?.full_name||"Cliente",className:"w-6 h-6 rounded-full border border-gray-200"}),s.jsx("p",{className:"text-sm text-gray-700 font-medium",children:e.client?.full_name||"Cliente sin nombre"})]}),"open"===e.status&&(0,s.jsxs)("div",{className:"flex gap-2 mt-3",children:[s.jsx("button",{onClick:()=>I(e),className:"flex-1 bg-emerald-500 text-white py-2 rounded-xl hover:bg-emerald-600 font-semibold",children:"Aceptar"}),s.jsx("button",{onClick:()=>Y(e),className:"flex-1 bg-gray-200 text-gray-700 py-2 rounded-xl hover:bg-gray-300 font-semibold",children:"Rechazar"})]}),"accepted"===e.status&&(0,s.jsxs)("div",{className:"flex flex-col gap-2 mt-3",children:[(0,s.jsxs)("button",{onClick:()=>window.open(`https://www.google.com/maps/dir/?api=1&destination=${e.client_lat},${e.client_lng}`,"_blank"),className:"w-full bg-emerald-100 text-emerald-700 py-2 rounded-xl font-semibold hover:bg-emerald-200 transition flex items-center justify-center gap-1",children:[s.jsx(p,{size:16})," Ver ubicaci\xf3n"]}),s.jsx("button",{onClick:()=>V(e),className:"w-full bg-gray-100 text-gray-800 py-2 rounded-xl font-semibold hover:bg-gray-200 transition",children:"\uD83D\uDCAC Chat con cliente"}),(0,s.jsxs)("button",{onClick:()=>G(e),className:"w-full bg-emerald-600 text-white py-2 rounded-xl font-semibold hover:bg-emerald-700 transition flex items-center justify-center gap-1",children:[s.jsx(m,{size:16})," Finalizar trabajo"]})]}),"completed"===e.status&&s.jsx("div",{className:"mt-3 text-center text-emerald-600 font-medium",children:"✅ Trabajo finalizado"})]},e.id))}),s.jsx(l.M,{children:C&&N&&s.jsx(i.E.div,{className:"fixed inset-0 bg-black/40 flex justify-center items-end z-[80]",children:(0,s.jsxs)(i.E.div,{className:"bg-white rounded-t-3xl w-full max-w-md shadow-xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-100 bg-gray-50",children:[(0,s.jsxs)("button",{onClick:()=>O(!1),className:"flex items-center gap-1 text-gray-600 hover:text-red-500",children:[s.jsx(x.Z,{size:18})," Volver"]}),s.jsx("h2",{className:"font-semibold text-gray-800",children:"Chat con cliente"}),(0,s.jsxs)("button",{onClick:()=>window.open(`https://www.google.com/maps/dir/?api=1&destination=${N.client_lat},${N.client_lng}`,"_blank"),className:"flex items-center gap-1 text-emerald-600 hover:text-emerald-800 text-sm font-semibold",children:[s.jsx(p,{size:16})," Mapa"]})]}),(0,s.jsxs)("div",{className:"flex flex-col h-[70vh] bg-white",children:[(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-2",children:[E.map(e=>{let r=e.sender_id===t?.id;return s.jsx("div",{className:`flex ${r?"justify-end":"justify-start"}`,children:(0,s.jsxs)("div",{className:`max-w-[80%] px-3 py-2 rounded-2xl text-sm shadow-sm ${r?"bg-emerald-500 text-white":"bg-gray-100 text-gray-800"}`,children:[e.content,s.jsx("div",{className:`text-[10px] mt-1 opacity-70 ${r?"text-white":"text-gray-500"}`,children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id)}),s.jsx("div",{ref:$})]}),(0,s.jsxs)("form",{className:"p-3 border-t border-gray-100 flex gap-2",onSubmit:async e=>{e.preventDefault();let t=T.current?.value||"";await B(t),T.current&&(T.current.value="")},children:[s.jsx("input",{ref:T,type:"text",placeholder:"Escrib\xed un mensaje…",className:"flex-1 bg-gray-100 rounded-xl px-3 py-3 outline-none focus:ring-2 focus:ring-emerald-400 border border-gray-200"}),s.jsx("button",{disabled:R,className:"px-4 rounded-xl bg-emerald-500 text-white font-semibold hover:bg-emerald-600 transition disabled:opacity-60",children:s.jsx(h.Z,{size:18})})]})]})]})})}),(0,s.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 shadow-sm flex justify-around py-2 text-sm font-semibold z-50",children:[(0,s.jsxs)("button",{className:"flex flex-col items-center text-emerald-600",children:[s.jsx(f,{size:18})," ",s.jsx("span",{children:"Trabajos"})]}),(0,s.jsxs)("button",{onClick:()=>O(!0),className:"flex flex-col items-center text-gray-500",children:[s.jsx(g.Z,{size:18})," ",s.jsx("span",{children:"Chats"})]}),(0,s.jsxs)("button",{onClick:()=>e.push("/worker/onboard"),className:"flex flex-col items-center text-gray-500",children:[s.jsx(b.Z,{size:18})," ",s.jsx("span",{children:"Perfil"})]})]})]})}},1890:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(2881).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},7506:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(2881).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9730:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(2881).Z)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]])},939:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(2881).Z)("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]])},2382:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(2881).Z)("user-round",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]])},771:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>l});var s=r(8570);let a=(0,s.createProxy)(String.raw`D:\CARPETA ROGER\CONESTESOYBILLONARIOYALOSOY\jobs-mvp-next-pro-main\app\worker\page.jsx`),{__esModule:n,$$typeof:i}=a;a.default;let l=(0,s.createProxy)(String.raw`D:\CARPETA ROGER\CONESTESOYBILLONARIOYALOSOY\jobs-mvp-next-pro-main\app\worker\page.jsx#default`)},9086:(e,t,r)=>{"use strict";r.d(t,{M:()=>y});var s=r(326),a=r(7577),n=r(339),i=r(7977),l=r(2482),o=r(295),c=r(9539),d=r(3965);function u(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class p extends a.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,r=(0,c.R)(e)&&e.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=r-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function m({children:e,isPresent:t,anchorX:r,root:n}){let i=(0,a.useId)(),l=(0,a.useRef)(null),o=(0,a.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=(0,a.useContext)(d._),m=function(...e){return a.useCallback(function(...e){return t=>{let r=!1,s=e.map(e=>{let s=u(e,t);return r||"function"!=typeof s||(r=!0),s});if(r)return()=>{for(let t=0;t<s.length;t++){let r=s[t];"function"==typeof r?r():u(e[t],null)}}}}(...e),e)}(l,e?.ref);return(0,a.useInsertionEffect)(()=>{let{width:e,height:s,top:a,left:d,right:u}=o.current;if(t||!l.current||!e||!s)return;let p="left"===r?`left: ${d}`:`right: ${u}`;l.current.dataset.motionPopId=i;let m=document.createElement("style");c&&(m.nonce=c);let x=n??document.head;return x.appendChild(m),m.sheet&&m.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${s}px !important;
            ${p}px !important;
            top: ${a}px !important;
          }
        `),()=>{x.contains(m)&&x.removeChild(m)}},[t]),(0,s.jsx)(p,{isPresent:t,childRef:l,sizeRef:o,children:a.cloneElement(e,{ref:m})})}let x=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:l,presenceAffectsLayout:c,mode:d,anchorX:u,root:p})=>{let x=(0,i.h)(h),f=(0,a.useId)(),g=!0,b=(0,a.useMemo)(()=>(g=!1,{id:f,initial:t,isPresent:r,custom:l,onExitComplete:e=>{for(let t of(x.set(e,!0),x.values()))if(!t)return;n&&n()},register:e=>(x.set(e,!1),()=>x.delete(e))}),[r,x,n]);return c&&g&&(b={...b}),(0,a.useMemo)(()=>{x.forEach((e,t)=>x.set(t,!1))},[r]),a.useEffect(()=>{r||x.size||!n||n()},[r]),"popLayout"===d&&(e=(0,s.jsx)(m,{isPresent:r,anchorX:u,root:p,children:e})),(0,s.jsx)(o.O.Provider,{value:b,children:e})};function h(){return new Map}var f=r(6933);let g=e=>e.key||"";function b(e){let t=[];return a.Children.forEach(e,e=>{(0,a.isValidElement)(e)&&t.push(e)}),t}let y=({children:e,custom:t,initial:r=!0,onExitComplete:o,presenceAffectsLayout:c=!0,mode:d="sync",propagate:u=!1,anchorX:p="left",root:m})=>{let[h,y]=(0,f.oO)(u),j=(0,a.useMemo)(()=>b(e),[e]),w=u&&!h?[]:j.map(g),v=(0,a.useRef)(!0),_=(0,a.useRef)(j),N=(0,i.h)(()=>new Map),[k,E]=(0,a.useState)(j),[A,C]=(0,a.useState)(j);(0,l.L)(()=>{v.current=!1,_.current=j;for(let e=0;e<A.length;e++){let t=g(A[e]);w.includes(t)?N.delete(t):!0!==N.get(t)&&N.set(t,!1)}},[A,w.length,w.join("-")]);let O=[];if(j!==k){let e=[...j];for(let t=0;t<A.length;t++){let r=A[t],s=g(r);w.includes(s)||(e.splice(t,0,r),O.push(r))}return"wait"===d&&O.length&&(e=O),C(b(e)),E(j),null}let{forceRender:R}=(0,a.useContext)(n.p);return(0,s.jsx)(s.Fragment,{children:A.map(e=>{let a=g(e),n=(!u||!!h)&&(j===A||w.includes(a));return(0,s.jsx)(x,{isPresent:n,initial:(!v.current||!!r)&&void 0,custom:t,presenceAffectsLayout:c,mode:d,root:m,onExitComplete:n?void 0:()=>{if(!N.has(a))return;N.set(a,!0);let e=!0;N.forEach(t=>{t||(e=!1)}),e&&(R?.(),C(_.current),u&&y?.(),o&&o())},anchorX:p,children:e},a)})})}}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,606,163,153],()=>r(9801));module.exports=s})();